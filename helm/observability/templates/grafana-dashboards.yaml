apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: observability
data:
  db-metrics.json: |
    {
      "dashboard": {
        "title": "Database Metrics",
        "panels": [
          {
            "id": 1,
            "title": "Database Connections",
            "type": "stat",
            "targets": [{"expr": "pg_stat_database_numbackends{datname=\"student_db\"}"}]
          },
          {
            "id": 2,
            "title": "Database Size",
            "type": "stat",
            "targets": [{"expr": "pg_database_size_bytes{datname=\"student_db\"}"}]
          }
        ]
      }
    }
  
  app-logs.json: |
    {
      "dashboard": {
        "title": "Application Error Logs",
        "panels": [
          {
            "id": 1,
            "title": "Error Logs",
            "type": "logs",
            "targets": [{"expr": "{job=\"containerlogs\"} |~ \"(?i)(error|exception|fail)\""}]
          }
        ]
      }
    }

  node-metrics.json: |
    {
      "dashboard": {
        "title": "Node Metrics",
        "panels": [
          {
            "id": 1,
            "title": "CPU Usage",
            "type": "stat",
            "targets": [{"expr": "100 - (avg(rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)"}]
          },
          {
            "id": 2,
            "title": "Disk Usage",
            "type": "stat",
            "targets": [{"expr": "(1 - (node_filesystem_avail_bytes{mountpoint=\"/\"} / node_filesystem_size_bytes{mountpoint=\"/\"})) * 100"}]
          }
        ]
      }
    }

  kube-metrics.json: |
    {
      "dashboard": {
        "title": "Kube-state Metrics",
        "panels": [
          {
            "id": 1,
            "title": "Running Pods",
            "type": "stat",
            "targets": [{"expr": "kube_pod_status_phase{phase=\"Running\"}"}]
          }
        ]
      }
    }

  blackbox-metrics.json: |
    {
      "dashboard": {
        "title": "Blackbox Metrics",
        "panels": [
          {
            "id": 1,
            "title": "Service Uptime",
            "type": "stat",
            "targets": [{"expr": "probe_success"}]
          },
          {
            "id": 2,
            "title": "Response Time",
            "type": "graph",
            "targets": [{"expr": "probe_duration_seconds"}]
          }
        ]
      }
    }